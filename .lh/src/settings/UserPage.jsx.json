{
    "sourceFile": "src/settings/UserPage.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1765713836138,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1765713847156,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -781,10 +781,10 @@\n                       <Button\n                         variant=\"contained\"\n                         color=\"error\"\n                         onClick={handleDelete}\n-                        startIcon={<DeleteForeverIcon fontSize=\"small\" />}\n-                        className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n+                        startIcon={<DeleteForeverIcon />}\n+                        className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-xl hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n                       >\n                         {t('userDeleteAccount')}\n                       </Button>\n                     </div>\n"
                },
                {
                    "date": 1765714345161,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -243,9 +243,9 @@\n                           className: \"rounded-xl\"\n                         }}\n                       />\n                       <div className=\"absolute inset-y-0 right-0 flex items-center pr-3\">\n-                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n+                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                           <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\n                         </svg>\n                       </div>\n                     </div>\n@@ -274,10 +274,10 @@\n                             </InputAdornment>\n                           )}\n                         />\n                       </FormControl>\n-                      <div className=\"absolute inset-y-0 right-32 flex items-center pr-3\">\n-                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n+                      <div className=\"absolute inset-y-0 right-24 flex items-center pr-3\">\n+                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                           <path fillRule=\"evenodd\" d=\"M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 2 2 0 012 2 1 1 0 102 0 4 4 0 00-4-4z\" clipRule=\"evenodd\" />\n                         </svg>\n                       </div>\n                     </div>\n@@ -718,9 +718,9 @@\n                   <Button\n                     variant=\"contained\"\n                     color=\"error\"\n                     onClick={() => setRevokeDialogOpen(true)}\n-                    className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n+                    className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n                   >\n                     {t('userRevokeToken')}\n                   </Button>\n                 </div>\n@@ -831,17 +831,17 @@\n           <div className=\"flex justify-end space-x-3\">\n             <Button\n               onClick={closeRevokeDialog}\n               variant=\"outlined\"\n-              className=\"border-gray-300 text-gray-700 hover:bg-gray-50 px-4 py-2 rounded-lg\"\n+              className=\"border-gray-300 text-gray-700 hover:bg-gray-50 px-6 py-2 rounded-xl\"\n             >\n               {t('sharedCancel')}\n             </Button>\n             <Button\n               onClick={handleRevokeToken}\n               disabled={!revokeToken}\n               variant=\"contained\"\n-              className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n+              className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-2 rounded-xl hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n             >\n               {t('userRevokeToken')}\n             </Button>\n           </div>\n"
                },
                {
                    "date": 1765801390794,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,50 +1,50 @@\n-import { useEffect, useState } from 'react';\n-import { useNavigate, useParams, useSearchParams } from 'react-router-dom';\n import {\n-  Accordion,\n-  AccordionSummary,\n-  AccordionDetails,\n-  Typography,\n+  Button,\n+  Card,\n+  CardContent,\n+  Checkbox,\n+  Dialog,\n+  DialogActions,\n+  DialogContent,\n   FormControl,\n-  InputLabel,\n-  Select,\n-  MenuItem,\n   FormControlLabel,\n-  Checkbox,\n-  FormGroup,\n-  TextField,\n-  Button,\n+  Grid,\n+  IconButton,\n   InputAdornment,\n-  IconButton,\n+  MenuItem,\n   OutlinedInput,\n-  Dialog,\n-  DialogContent,\n-  DialogActions,\n+  Select,\n+  TextField,\n+  Typography,\n+  Container,\n } from '@mui/material';\n-import ExpandMoreIcon from '@mui/icons-material/ExpandMore';\n-import DeleteForeverIcon from '@mui/icons-material/DeleteForever';\n import CachedIcon from '@mui/icons-material/Cached';\n import CloseIcon from '@mui/icons-material/Close';\n+import DeleteForeverIcon from '@mui/icons-material/DeleteForever';\n+import { useEffect, useState } from 'react';\n import { useDispatch, useSelector } from 'react-redux';\n-import EditItemView from './components/EditItemView';\n-import EditAttributesAccordion from './components/EditAttributesAccordion';\n+import { useNavigate, useParams, useSearchParams } from 'react-router-dom';\n+import useUserAttributes from '../common/attributes/useUserAttributes';\n import { useTranslation } from '../common/components/LocalizationProvider';\n-import useUserAttributes from '../common/attributes/useUserAttributes';\n+import SelectField from '../common/components/SelectField';\n+import { useAdministrator, useManager, useRestriction } from '../common/util/permissions';\n+import { useCatch, useEffectAsync } from '../reactHelper';\n import { sessionActions } from '../store';\n-import SelectField from '../common/components/SelectField';\n+import EditAttributesAccordion from './components/EditAttributesAccordion';\n import SettingsMenu from './components/SettingsMenu';\n import useCommonUserAttributes from '../common/attributes/useCommonUserAttributes';\n-import { useAdministrator, useRestriction, useManager } from '../common/util/permissions';\n-import { useCatch } from '../reactHelper';\n import useMapStyles from '../map/core/useMapStyles';\n import { map } from '../map/core/MapView';\n import fetchOrThrow from '../common/util/fetchOrThrow';\n+import PageLayout from '../common/components/PageLayout';\n+import useSettingsStyles from './common/useSettingsStyles';\n \n const UserPage = () => {\n   const navigate = useNavigate();\n   const dispatch = useDispatch();\n   const t = useTranslation();\n+  const { classes } = useSettingsStyles();\n \n   const admin = useAdministrator();\n   const manager = useManager();\n   const fixedEmail = useRestriction('fixedEmail');\n@@ -59,10 +59,23 @@\n   const commonUserAttributes = useCommonUserAttributes(t);\n   const userAttributes = useUserAttributes(t);\n \n   const { id } = useParams();\n-  const [item, setItem] = useState(id === currentUser.id.toString() ? currentUser : null);\n+  const [item, setItem] = useState(null);\n \n+  useEffectAsync(async () => {\n+    if (id) {\n+      if (id === currentUser.id.toString()) {\n+        setItem(currentUser);\n+      } else {\n+        const response = await fetchOrThrow(`/api/users/${id}`);\n+        setItem(await response.json());\n+      }\n+    } else {\n+      setItem(admin ? { deviceLimit: 0, userLimit: 1, administrator: false } : {});\n+    }\n+  }, [id, currentUser]);\n+\n   const [deleteEmail, setDeleteEmail] = useState();\n   const [deleteFailed, setDeleteFailed] = useState(false);\n   const [revokeDialogOpen, setRevokeDialogOpen] = useState(false);\n   const [revokeToken, setRevokeToken] = useState('');\n@@ -96,34 +109,33 @@\n     });\n     closeRevokeDialog();\n   });\n \n-  // Handle user type change with appropriate defaults\n   const handleUserTypeChange = (role) => {\n     if (role === 'manager') {\n       setItem({\n         ...item,\n         administrator: false,\n         userLimit: 1,\n         deviceLimit: 0,\n-        deviceReadonly: false\n+        deviceReadonly: false,\n       });\n     } else if (role === 'user') {\n       setItem({\n         ...item,\n         administrator: false,\n         userLimit: 0,\n-        deviceLimit: 0,\n-        deviceReadonly: true\n+        deviceLimit: -1,\n+        deviceReadonly: true,\n       });\n     }\n   };\n \n   const [searchParams, setSearchParams] = useSearchParams();\n   const attribute = searchParams.get('attribute');\n \n   useEffect(() => {\n-    if (item && attribute && !item.attributes.hasOwnProperty('attribute')) {\n+    if (item && attribute && item.attributes && !item.attributes.hasOwnProperty(attribute)) {\n       const updatedAttributes = { ...item.attributes };\n       updatedAttributes[attribute] = '';\n       setItem({ ...item, attributes: updatedAttributes });\n \n@@ -138,717 +150,402 @@\n       dispatch(sessionActions.updateUser(result));\n     }\n   };\n \n+  const handleSave = useCatch(async () => {\n+    let url = '/api/users';\n+    if (id) {\n+      url += `/${id}`;\n+    }\n+\n+    const response = await fetchOrThrow(url, {\n+      method: !id ? 'POST' : 'PUT',\n+      headers: { 'Content-Type': 'application/json' },\n+      body: JSON.stringify(item),\n+    });\n+\n+    onItemSaved(await response.json());\n+    navigate(-1);\n+  });\n+\n   const validate = () => item && item.name && item.email && (item.id || item.password) && (admin || !totpForce || item.totpKey);\n \n   return (\n-    <EditItemView\n-      endpoint=\"users\"\n-      item={item}\n-      setItem={setItem}\n-      defaultItem={admin ? { deviceLimit: 0, userLimit: 0, administrator: false, deviceReadonly: true } : {}}\n-      validate={validate}\n-      onItemSaved={onItemSaved}\n+    <PageLayout\n       menu={<SettingsMenu />}\n       breadcrumbs={['settingsTitle', 'settingsUser']}\n     >\n       {item && (\n-        <div className=\"p-6 max-w-7xl mx-auto\">\n-          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n-            {/* Left Column - Basic Information */}\n-            <div className=\"lg:col-span-1 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n-              <h2 className=\"text-xl font-bold text-gray-800 mb-6 pb-3 border-b border-gray-200 flex items-center\">\n-                <span className=\"bg-blue-100 text-blue-600 p-1.5 rounded-lg mr-2\">\n-                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                    <path fillRule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clipRule=\"evenodd\" />\n-                  </svg>\n-                </span>\n-                {t('sharedRequired')}\n-              </h2>\n-\n-              <div className=\"space-y-6\">\n-                {admin && (\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userType')}</label>\n-                    <div className=\"relative\">\n-                      <FormControl fullWidth>\n-                        <Select\n-                          value={\n-                            (item.userLimit === 1 && item.deviceLimit === 0) ? 'manager' : 'user'\n-                          }\n-                          onChange={(e) => handleUserTypeChange(e.target.value)}\n-                          className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                        >\n-                          <MenuItem value=\"manager\">{t('userTypeManager')}</MenuItem>\n-                          <MenuItem value=\"user\">{t('userTypeUser')}</MenuItem>\n-                        </Select>\n-                      </FormControl>\n-                    </div>\n-                  </div>\n-                )}\n-\n-                <div>\n-                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('sharedName')}</label>\n-                  <div className=\"relative\">\n+        <Container maxWidth=\"xl\" className={classes.container}>\n+          <div style={{ display: 'flex', gap: '24px', flexWrap: 'wrap' }}>\n+            <div style={{ flex: '1 1 48%', minWidth: '300px', display: 'flex' }}>\n+              <Card style={{ flex: 1, display: 'flex', flexDirection: 'column' }}>\n+                <CardContent style={{ flex: 1 }}>\n+                  <Typography variant=\"h6\" gutterBottom>{t('sharedRequired')}</Typography>\n+                  {admin && (\n+                    <FormControl fullWidth margin=\"normal\">\n+                      <Select\n+                        value={(item.userLimit > 0 && item.deviceLimit === 0) ? 'manager' : 'user'}\n+                        onChange={(e) => handleUserTypeChange(e.target.value)}\n+                      >\n+                        <MenuItem value=\"manager\">{t('userTypeManager')}</MenuItem>\n+                        <MenuItem value=\"user\">{t('userTypeUser')}</MenuItem>\n+                      </Select>\n+                    </FormControl>\n+                  )}\n+                  <TextField\n+                    label={t('sharedName')}\n+                    value={item.name || ''}\n+                    onChange={(e) => setItem({ ...item, name: e.target.value })}\n+                    fullWidth\n+                    margin=\"normal\"\n+                  />\n+                  <TextField\n+                    label={t('userEmail')}\n+                    value={item.email || ''}\n+                    onChange={(e) => setItem({ ...item, email: e.target.value })}\n+                    fullWidth\n+                    margin=\"normal\"\n+                    disabled={fixedEmail && item.id === currentUser.id}\n+                  />\n+                  {!openIdForced && (\n                     <TextField\n-                      value={item.name || ''}\n-                      onChange={(e) => setItem({ ...item, name: e.target.value })}\n+                      label={t('userPassword')}\n+                      type=\"password\"\n+                      value={item.password || ''}\n+                      onChange={(e) => setItem({ ...item, password: e.target.value })}\n                       fullWidth\n-                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                      InputProps={{\n-                        className: \"rounded-xl\"\n-                      }}\n+                      margin=\"normal\"\n                     />\n-                    <div className=\"absolute inset-y-0 right-0 flex items-center pr-3\">\n-                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                        <path fillRule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clipRule=\"evenodd\" />\n-                      </svg>\n-                    </div>\n-                  </div>\n-                </div>\n-\n-                <div>\n-                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userEmail')}</label>\n-                  <div className=\"relative\">\n-                    <TextField\n-                      value={item.email || ''}\n-                      onChange={(e) => setItem({ ...item, email: e.target.value })}\n-                      fullWidth\n-                      disabled={fixedEmail && item.id === currentUser.id}\n-                      className={`bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${fixedEmail && item.id === currentUser.id ? 'bg-gray-100' : ''}`}\n-                      InputProps={{\n-                        className: \"rounded-xl\"\n-                      }}\n-                    />\n-                    <div className=\"absolute inset-y-0 right-0 flex items-center pr-3\">\n-                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                        <path d=\"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z\" />\n-                        <path d=\"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z\" />\n-                      </svg>\n-                    </div>\n-                  </div>\n-                </div>\n-\n-                {!openIdForced && (\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userPassword')}</label>\n-                    <div className=\"relative\">\n+                  )}\n+                  {totpEnable && (\n+                    <FormControl fullWidth margin=\"normal\">\n+                      <OutlinedInput\n+                        readOnly\n+                        value={item.totpKey || ''}\n+                        endAdornment={(\n+                          <InputAdornment position=\"end\">\n+                            <IconButton size=\"small\" edge=\"end\" onClick={handleGenerateTotp}>\n+                              <CachedIcon fontSize=\"small\" />\n+                            </IconButton>\n+                            <IconButton size=\"small\" edge=\"end\" onClick={() => setItem({ ...item, totpKey: null })}>\n+                              <CloseIcon fontSize=\"small\" />\n+                            </IconButton>\n+                          </InputAdornment>\n+                        )}\n+                      />\n+                    </FormControl>\n+                  )}\n+                </CardContent>\n+              </Card>\n+            </div>\n+            <div style={{ flex: '1 1 48%', minWidth: '300px', display: 'flex' }}>\n+              <Card style={{ flex: 1, display: 'flex', flexDirection: 'column' }}>\n+                <CardContent style={{ flex: 1 }}>\n+                  <Typography variant=\"h6\" gutterBottom>{t('sharedPermissions')}</Typography>\n+                  <Grid container spacing={2}>\n+                    <Grid item xs={12} sm={6}>\n                       <TextField\n-                        type=\"password\"\n-                        value={item.password || ''}\n-                        onChange={(e) => setItem({ ...item, password: e.target.value })}\n+                        label={t('userExpirationTime')}\n+                        type=\"date\"\n+                        value={item.expirationTime ? item.expirationTime.split('T')[0] : ''}\n+                        onChange={(e) => setItem({ ...item, expirationTime: new Date(e.target.value).toISOString() })}\n+                        disabled={!manager}\n                         fullWidth\n-                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                        InputProps={{\n-                          className: \"rounded-xl\"\n-                        }}\n+                        InputLabelProps={{ shrink: true }}\n                       />\n-                      <div className=\"absolute inset-y-0 right-0 flex items-center pr-3\">\n-                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                          <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\n-                        </svg>\n-                      </div>\n-                    </div>\n-                  </div>\n-                )}\n-\n-                {totpEnable && (\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('loginTotpKey')}</label>\n-                    <div className=\"relative\">\n-                      <FormControl fullWidth>\n-                        <OutlinedInput\n-                          readOnly\n-                          value={item.totpKey || ''}\n-                          className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                          endAdornment={(\n-                            <InputAdornment position=\"end\">\n-                              <div className=\"flex space-x-2\">\n-                                <IconButton size=\"small\" edge=\"end\" onClick={handleGenerateTotp}>\n-                                  <CachedIcon fontSize=\"small\" className=\"text-blue-600\" />\n-                                </IconButton>\n-                                <IconButton size=\"small\" edge=\"end\" onClick={() => setItem({ ...item, totpKey: null })}>\n-                                  <CloseIcon fontSize=\"small\" className=\"text-red-600\" />\n-                                </IconButton>\n-                              </div>\n-                            </InputAdornment>\n-                          )}\n+                    </Grid>\n+                    <Grid item xs={12} sm={6}>\n+                      <TextField\n+                        label={t('userDeviceLimit')}\n+                        type=\"number\"\n+                        value={item.deviceLimit || 0}\n+                        onChange={(e) => setItem({ ...item, deviceLimit: Number(e.target.value) })}\n+                        disabled={!admin}\n+                        fullWidth\n+                      />\n+                    </Grid>\n+                    <Grid item xs={12} sm={6}>\n+                      <TextField\n+                        label={t('userUserLimit')}\n+                        type=\"number\"\n+                        value={item.userLimit || 0}\n+                        onChange={(e) => setItem({ ...item, userLimit: Number(e.target.value) })}\n+                        disabled={!admin}\n+                        fullWidth\n+                      />\n+                    </Grid>\n+                    <Grid item xs={12} container spacing={1}>\n+                      <Grid item xs={12} sm={6}>\n+                        <FormControlLabel\n+                          control={<Checkbox checked={item.disabled || false} onChange={(e) => setItem({ ...item, disabled: e.target.checked })} />}\n+                          label={t('sharedDisabled')}\n+                          disabled={!manager}\n+                          sx={{ display: 'block' }}\n                         />\n-                      </FormControl>\n-                      <div className=\"absolute inset-y-0 right-24 flex items-center pr-3\">\n-                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                          <path fillRule=\"evenodd\" d=\"M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 2 2 0 012 2 1 1 0 102 0 4 4 0 00-4-4z\" clipRule=\"evenodd\" />\n-                        </svg>\n-                      </div>\n-                    </div>\n-                  </div>\n-                )}\n-              </div>\n-            </div>\n-\n-            {/* Right Column - Permissions, Preferences, Location */}\n-            <div className=\"lg:col-span-2 space-y-6\">\n-              {/* Permissions Section */}\n-              <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n-                <h2 className=\"text-xl font-bold text-gray-800 mb-6 pb-3 border-b border-gray-200 flex items-center\">\n-                  <span className=\"bg-green-100 text-green-600 p-1.5 rounded-lg mr-2\">\n-                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                      <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\n-                    </svg>\n-                  </span>\n-                  {t('sharedPermissions')}\n-                </h2>\n-\n-                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userExpirationTime')}</label>\n-                    <TextField\n-                      type=\"date\"\n-                      value={item.expirationTime ? item.expirationTime.split('T')[0] : '2099-01-01'}\n-                      onChange={(e) => {\n-                        if (e.target.value) {\n-                          setItem({ ...item, expirationTime: new Date(e.target.value).toISOString() });\n-                        }\n-                      }}\n-                      disabled={!manager}\n-                      fullWidth\n-                      InputProps={{\n-                        className: \"rounded-xl\"\n-                      }}\n-                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                    />\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userDeviceLimit')}</label>\n-                    <TextField\n-                      type=\"number\"\n-                      value={item.deviceLimit || 0}\n-                      onChange={(e) => setItem({ ...item, deviceLimit: Number(e.target.value) })}\n-                      disabled={!admin}\n-                      fullWidth\n-                      InputProps={{\n-                        className: \"rounded-xl\"\n-                      }}\n-                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                    />\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userUserLimit')}</label>\n-                    <TextField\n-                      type=\"number\"\n-                      value={item.userLimit || 0}\n-                      onChange={(e) => setItem({ ...item, userLimit: Number(e.target.value) })}\n-                      disabled={!admin}\n-                      fullWidth\n-                      InputProps={{\n-                        className: \"rounded-xl\"\n-                      }}\n-                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                    />\n-                  </div>\n-                </div>\n-\n-                <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n-                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n-                    <FormControlLabel\n-                      control={\n-                        <Checkbox\n-                          checked={item.disabled}\n-                          onChange={(e) => setItem({ ...item, disabled: e.target.checked })}\n-                          className=\"text-blue-600\"\n+                      </Grid>\n+                      <Grid item xs={12} sm={6}>\n+                        <FormControlLabel\n+                          control={<Checkbox checked={item.administrator || false} onChange={(e) => setItem({ ...item, administrator: e.target.checked })} />}\n+                          label={t('userAdmin')}\n+                          disabled={!admin}\n+                          sx={{ display: 'block' }}\n                         />\n-                      }\n-                      label={t('sharedDisabled')}\n-                      disabled={!manager}\n-                      className=\"m-0\"\n-                    />\n-                  </div>\n-\n-                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n-                    <FormControlLabel\n-                      control={\n-                        <Checkbox\n-                          checked={item.administrator}\n-                          onChange={(e) => setItem({ ...item, administrator: e.target.checked })}\n-                          className=\"text-blue-600\"\n+                      </Grid>\n+                      <Grid item xs={12} sm={6}>\n+                        <FormControlLabel\n+                          control={<Checkbox checked={item.readonly || false} onChange={(e) => setItem({ ...item, readonly: e.target.checked })} />}\n+                          label={t('serverReadonly')}\n+                          disabled={!manager}\n+                          sx={{ display: 'block' }}\n                         />\n-                      }\n-                      label={t('userAdmin')}\n-                      disabled={!admin}\n-                      className=\"m-0\"\n-                    />\n-                  </div>\n-\n-                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n-                    <FormControlLabel\n-                      control={\n-                        <Checkbox\n-                          checked={item.readonly}\n-                          onChange={(e) => setItem({ ...item, readonly: e.target.checked })}\n-                          className=\"text-blue-600\"\n+                      </Grid>\n+                      <Grid item xs={12} sm={6}>\n+                        <FormControlLabel\n+                          control={<Checkbox checked={item.deviceReadonly || false} onChange={(e) => setItem({ ...item, deviceReadonly: e.target.checked })} />}\n+                          label={t('userDeviceReadonly')}\n+                          disabled={!manager}\n+                          sx={{ display: 'block' }}\n                         />\n-                      }\n-                      label={t('serverReadonly')}\n-                      disabled={!manager}\n-                      className=\"m-0\"\n-                    />\n-                  </div>\n-\n-                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n-                    <FormControlLabel\n-                      control={\n-                        <Checkbox\n-                          checked={item.deviceReadonly}\n-                          onChange={(e) => setItem({ ...item, deviceReadonly: e.target.checked })}\n-                          className=\"text-blue-600\"\n+                      </Grid>\n+                      <Grid item xs={12} sm={6}>\n+                        <FormControlLabel\n+                          control={<Checkbox checked={item.limitCommands || false} onChange={(e) => setItem({ ...item, limitCommands: e.target.checked })} />}\n+                          label={t('userLimitCommands')}\n+                          disabled={!manager}\n+                          sx={{ display: 'block' }}\n                         />\n-                      }\n-                      label={t('userDeviceReadonly')}\n-                      disabled={!manager}\n-                      className=\"m-0\"\n-                    />\n-                  </div>\n-\n-                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n-                    <FormControlLabel\n-                      control={\n-                        <Checkbox\n-                          checked={item.limitCommands}\n-                          onChange={(e) => setItem({ ...item, limitCommands: e.target.checked })}\n-                          className=\"text-blue-600\"\n+                      </Grid>\n+                      <Grid item xs={12} sm={6}>\n+                        <FormControlLabel\n+                          control={<Checkbox checked={item.disableReports || false} onChange={(e) => setItem({ ...item, disableReports: e.target.checked })} />}\n+                          label={t('userDisableReports')}\n+                          disabled={!manager}\n+                          sx={{ display: 'block' }}\n                         />\n-                      }\n-                      label={t('userLimitCommands')}\n-                      disabled={!manager}\n-                      className=\"m-0\"\n-                    />\n-                  </div>\n-\n-                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n-                    <FormControlLabel\n-                      control={\n-                        <Checkbox\n-                          checked={item.disableReports}\n-                          onChange={(e) => setItem({ ...item, disableReports: e.target.checked })}\n-                          className=\"text-blue-600\"\n+                      </Grid>\n+                      <Grid item xs={12} sm={6}>\n+                        <FormControlLabel\n+                          control={<Checkbox checked={item.fixedEmail || false} onChange={(e) => setItem({ ...item, fixedEmail: e.target.checked })} />}\n+                          label={t('userFixedEmail')}\n+                          disabled={!manager}\n+                          sx={{ display: 'block' }}\n                         />\n-                      }\n-                      label={t('userDisableReports')}\n-                      disabled={!manager}\n-                      className=\"m-0\"\n-                    />\n-                  </div>\n-\n-                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n-                    <FormControlLabel\n-                      control={\n-                        <Checkbox\n-                          checked={item.fixedEmail}\n-                          onChange={(e) => setItem({ ...item, fixedEmail: e.target.checked })}\n-                          className=\"text-blue-600\"\n-                        />\n-                      }\n-                      label={t('userFixedEmail')}\n-                      disabled={!manager}\n-                      className=\"m-0\"\n-                    />\n-                  </div>\n-                </div>\n-              </div>\n-\n-              {/* Preferences Section */}\n-              <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n-                <h2 className=\"text-xl font-bold text-gray-800 mb-6 pb-3 border-b border-gray-200 flex items-center\">\n-                  <span className=\"bg-purple-100 text-purple-600 p-1.5 rounded-lg mr-2\">\n-                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                      <path d=\"M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z\" />\n-                    </svg>\n-                  </span>\n-                  {t('sharedPreferences')}\n-                </h2>\n-\n-                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('sharedPhone')}</label>\n-                    <TextField\n-                      value={item.phone || ''}\n-                      onChange={(e) => setItem({ ...item, phone: e.target.value })}\n-                      fullWidth\n-                      InputProps={{\n-                        className: \"rounded-xl\"\n-                      }}\n-                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                    />\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('mapDefault')}</label>\n-                    <FormControl fullWidth>\n-                      <Select\n-                        value={item.map || 'locationIqStreets'}\n-                        onChange={(e) => setItem({ ...item, map: e.target.value })}\n-                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                        MenuProps={{\n-                          classes: { paper: \"rounded-xl\" }\n+                      </Grid>\n+                    </Grid>\n+                  </Grid>\n+                </CardContent>\n+              </Card>\n+            </div>\n+          </div>\n+          <Grid container spacing={3} style={{ marginTop: '24px', width: '100%' }}>\n+            <Grid item xs={12}>\n+              <Card>\n+                <CardContent>\n+                  <Typography variant=\"h6\" gutterBottom>{t('sharedPreferences')}</Typography>\n+                  <Grid container spacing={2}>\n+                    <Grid item xs={12} sm={6}>\n+                      <TextField\n+                        label={t('sharedPhone')}\n+                        value={item.phone || ''}\n+                        onChange={(e) => setItem({ ...item, phone: e.target.value })}\n+                        fullWidth\n+                      />\n+                    </Grid>\n+                    <Grid item xs={12} sm={6}>\n+                      <FormControl fullWidth>\n+                        <Select\n+                          value={item.map || 'locationIqStreets'}\n+                          onChange={(e) => setItem({ ...item, map: e.target.value })}\n+                        >\n+                          {mapStyles.filter((style) => style.available).map((style) => (\n+                            <MenuItem key={style.id} value={style.id}>\n+                              <Typography component=\"span\">{style.title}</Typography>\n+                            </MenuItem>\n+                          ))}\n+                        </Select>\n+                      </FormControl>\n+                    </Grid>\n+                    <Grid item xs={12} sm={6}>\n+                      <FormControl fullWidth>\n+                        <Select\n+                          value={item.coordinateFormat || 'dd'}\n+                          onChange={(e) => setItem({ ...item, coordinateFormat: e.target.value })}\n+                        >\n+                          <MenuItem value=\"dd\">{t('sharedDecimalDegrees')}</MenuItem>\n+                          <MenuItem value=\"ddm\">{t('sharedDegreesDecimalMinutes')}</MenuItem>\n+                          <MenuItem value=\"dms\">{t('sharedDegreesMinutesSeconds')}</MenuItem>\n+                        </Select>\n+                      </FormControl>\n+                    </Grid>\n+                    <Grid item xs={12} sm={6}>\n+                      <SelectField\n+                        label={t('sharedTimezone')}\n+                        value={item.attributes && item.attributes.timezone}\n+                        onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, timezone: e.target.value } })}\n+                        endpoint=\"/api/server/timezones\"\n+                        keyGetter={(it) => it}\n+                        titleGetter={(it) => it}\n+                        fullWidth\n+                        sx={{ width: '100%' }}\n+                      />\n+                    </Grid>\n+                    <Grid item xs={12}>\n+                      <TextField\n+                        label={t('mapPoiLayer')}\n+                        value={item.poiLayer || ''}\n+                        onChange={(e) => setItem({ ...item, poiLayer: e.target.value })}\n+                        fullWidth\n+                      />\n+                    </Grid>\n+                  </Grid>\n+                </CardContent>\n+              </Card>\n+            </Grid>\n+            <Grid item xs={12}>\n+              <Card>\n+                <CardContent>\n+                  <Typography variant=\"h6\" gutterBottom>{t('sharedLocation')}</Typography>\n+                  <Grid container spacing={2}>\n+                    <Grid item xs={12} sm={4}>\n+                      <TextField\n+                        label={t('positionLatitude')}\n+                        type=\"number\"\n+                        step=\"any\"\n+                        value={item.latitude || 0}\n+                        onChange={(e) => setItem({ ...item, latitude: Number(e.target.value) })}\n+                        fullWidth\n+                      />\n+                    </Grid>\n+                    <Grid item xs={12} sm={4}>\n+                      <TextField\n+                        label={t('positionLongitude')}\n+                        type=\"number\"\n+                        step=\"any\"\n+                        value={item.longitude || 0}\n+                        onChange={(e) => setItem({ ...item, longitude: Number(e.target.value) })}\n+                        fullWidth\n+                      />\n+                    </Grid>\n+                    <Grid item xs={12} sm={4}>\n+                      <TextField\n+                        label={t('serverZoom')}\n+                        type=\"number\"\n+                        step=\"any\"\n+                        value={item.zoom || 0}\n+                        onChange={(e) => setItem({ ...item, zoom: Number(e.target.value) })}\n+                        fullWidth\n+                      />\n+                    </Grid>\n+                    <Grid item xs={12}>\n+                      <Button\n+                        variant=\"outlined\"\n+                        color=\"primary\"\n+                        onClick={() => {\n+                          const { lng, lat } = map.getCenter();\n+                          setItem({time\n+                            ...item,\n+                            latitude: Number(lat.toFixed(6)),\n+                            longitude: Number(lng.toFixed(6)),\n+                            zoom: Number(map.getZoom().toFixed(1)),\n+                          });\n                         }}\n                       >\n-                        {mapStyles.filter((style) => style.available).map((style) => (\n-                          <MenuItem key={style.id} value={style.id}>\n-                            <Typography component=\"span\">{style.title}</Typography>\n-                          </MenuItem>\n-                        ))}\n-                      </Select>\n-                    </FormControl>\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('settingsCoordinateFormat')}</label>\n-                    <FormControl fullWidth>\n-                      <Select\n-                        value={item.coordinateFormat || 'dd'}\n-                        onChange={(e) => setItem({ ...item, coordinateFormat: e.target.value })}\n-                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                        MenuProps={{\n-                          classes: { paper: \"rounded-xl\" }\n-                        }}\n-                      >\n-                        <MenuItem value=\"dd\">{t('sharedDecimalDegrees')}</MenuItem>\n-                        <MenuItem value=\"ddm\">{t('sharedDegreesDecimalMinutes')}</MenuItem>\n-                        <MenuItem value=\"dms\">{t('sharedDegreesMinutesSeconds')}</MenuItem>\n-                      </Select>\n-                    </FormControl>\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('settingsSpeedUnit')}</label>\n-                    <FormControl fullWidth>\n-                      <Select\n-                        value={(item.attributes && item.attributes.speedUnit) || 'kn'}\n-                        onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, speedUnit: e.target.value } })}\n-                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                        MenuProps={{\n-                          classes: { paper: \"rounded-xl\" }\n-                        }}\n-                      >\n-                        <MenuItem value=\"kn\">{t('sharedKn')}</MenuItem>\n-                        <MenuItem value=\"kmh\">{t('sharedKmh')}</MenuItem>\n-                        <MenuItem value=\"mph\">{t('sharedMph')}</MenuItem>\n-                      </Select>\n-                    </FormControl>\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('settingsDistanceUnit')}</label>\n-                    <FormControl fullWidth>\n-                      <Select\n-                        value={(item.attributes && item.attributes.distanceUnit) || 'km'}\n-                        onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, distanceUnit: e.target.value } })}\n-                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                        MenuProps={{\n-                          classes: { paper: \"rounded-xl\" }\n-                        }}\n-                      >\n-                        <MenuItem value=\"km\">{t('sharedKm')}</MenuItem>\n-                        <MenuItem value=\"mi\">{t('sharedMi')}</MenuItem>\n-                        <MenuItem value=\"nmi\">{t('sharedNmi')}</MenuItem>\n-                      </Select>\n-                    </FormControl>\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('settingsAltitudeUnit')}</label>\n-                    <FormControl fullWidth>\n-                      <Select\n-                        value={(item.attributes && item.attributes.altitudeUnit) || 'm'}\n-                        onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, altitudeUnit: e.target.value } })}\n-                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                        MenuProps={{\n-                          classes: { paper: \"rounded-xl\" }\n-                        }}\n-                      >\n-                        <MenuItem value=\"m\">{t('sharedMeters')}</MenuItem>\n-                        <MenuItem value=\"ft\">{t('sharedFeet')}</MenuItem>\n-                      </Select>\n-                    </FormControl>\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('settingsVolumeUnit')}</label>\n-                    <FormControl fullWidth>\n-                      <Select\n-                        value={(item.attributes && item.attributes.volumeUnit) || 'ltr'}\n-                        onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, volumeUnit: e.target.value } })}\n-                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                        MenuProps={{\n-                          classes: { paper: \"rounded-xl\" }\n-                        }}\n-                      >\n-                        <MenuItem value=\"ltr\">{t('sharedLiter')}</MenuItem>\n-                        <MenuItem value=\"usGal\">{t('sharedUsGallon')}</MenuItem>\n-                        <MenuItem value=\"impGal\">{t('sharedImpGallon')}</MenuItem>\n-                      </Select>\n-                    </FormControl>\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('sharedTimezone')}</label>\n-                    <SelectField\n-                      value={item.attributes && item.attributes.timezone}\n-                      onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, timezone: e.target.value } })}\n-                      endpoint=\"/api/server/timezones\"\n-                      keyGetter={(it) => it}\n-                      titleGetter={(it) => it}\n-                      label={t('sharedTimezone')}\n-                      fullWidth\n-                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                    />\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('mapPoiLayer')}</label>\n+                        {t('mapCurrentLocation')}\n+                      </Button>\n+                    </Grid>\n+                  </Grid>\n+                </CardContent>\n+              </Card>\n+            </Grid>\n+            <Grid item xs={12}>\n+              <EditAttributesAccordion\n+                attribute={attribute}\n+                attributes={item.attributes}\n+                setAttributes={(attributes) => setItem({ ...item, attributes })}\n+                definitions={{ ...commonUserAttributes, ...userAttributes }}\n+                focusAttribute={attribute}\n+              />\n+            </Grid>\n+            {registrationEnabled && item.id === currentUser.id && !manager && (\n+              <Grid item xs={12}>\n+                <Card>\n+                  <CardContent>\n+                    <Typography variant=\"h6\" color=\"error\">{t('userDeleteAccount')}</Typography>\n                     <TextField\n-                      value={item.poiLayer || ''}\n-                      onChange={(e) => setItem({ ...item, poiLayer: e.target.value })}\n+                      label={t('userEmail')}\n+                      value={deleteEmail || ''}\n+                      onChange={(e) => setDeleteEmail(e.target.value)}\n+                      error={deleteFailed}\n+                      helperText={deleteFailed && t('userDeleteConfirm')}\n                       fullWidth\n-                      InputProps={{\n-                        className: \"rounded-xl\"\n-                      }}\n-                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n+                      margin=\"normal\"\n                     />\n-                  </div>\n-                </div>\n-              </div>\n-\n-              {/* Location Section */}\n-              <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n-                <h2 className=\"text-xl font-bold text-gray-800 mb-6 pb-3 border-b border-gray-200 flex items-center\">\n-                  <span className=\"bg-yellow-100 text-yellow-600 p-1.5 rounded-lg mr-2\">\n-                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                      <path fillRule=\"evenodd\" d=\"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z\" clipRule=\"evenodd\" />\n-                    </svg>\n-                  </span>\n-                  {t('sharedLocation')}\n-                </h2>\n-\n-                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('positionLatitude')}</label>\n-                    <TextField\n-                      type=\"number\"\n-                      step=\"any\"\n-                      value={item.latitude || 0}\n-                      onChange={(e) => setItem({ ...item, latitude: Number(e.target.value) })}\n-                      fullWidth\n-                      InputProps={{\n-                        className: \"rounded-xl\"\n-                      }}\n-                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                    />\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('positionLongitude')}</label>\n-                    <TextField\n-                      type=\"number\"\n-                      step=\"any\"\n-                      value={item.longitude || 0}\n-                      onChange={(e) => setItem({ ...item, longitude: Number(e.target.value) })}\n-                      fullWidth\n-                      InputProps={{\n-                        className: \"rounded-xl\"\n-                      }}\n-                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                    />\n-                  </div>\n-\n-                  <div>\n-                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('serverZoom')}</label>\n-                    <TextField\n-                      type=\"number\"\n-                      step=\"any\"\n-                      value={item.zoom || 0}\n-                      onChange={(e) => setItem({ ...item, zoom: Number(e.target.value) })}\n-                      fullWidth\n-                      InputProps={{\n-                        className: \"rounded-xl\"\n-                      }}\n-                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-                    />\n-                  </div>\n-                </div>\n-\n-                <div className=\"mt-6 flex justify-end\">\n+                    <Button\n+                      variant=\"outlined\"\n+                      color=\"error\"\n+                      onClick={handleDelete}\n+                      startIcon={<DeleteForeverIcon />}\n+                    >\n+                      {t('userDeleteAccount')}\n+                    </Button>\n+                  </CardContent>\n+                </Card>\n+              </Grid>\n+            )}\n+            <Grid item xs={12}>\n+              <Card>\n+                <CardContent>\n+                  <Typography variant=\"h6\">{t('userRevokeToken')}</Typography>\n                   <Button\n-                    variant=\"contained\"\n+                    variant=\"outlined\"\n                     color=\"primary\"\n-                    onClick={() => {\n-                      const { lng, lat } = map.getCenter();\n-                      setItem({\n-                        ...item,\n-                        latitude: Number(lat.toFixed(6)),\n-                        longitude: Number(lng.toFixed(6)),\n-                        zoom: Number(map.getZoom().toFixed(1)),\n-                      });\n-                    }}\n-                    className=\"bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-3 rounded-xl hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n-                    startIcon={\n-                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                        <path fillRule=\"evenodd\" d=\"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z\" clipRule=\"evenodd\" />\n-                      </svg>\n-                    }\n-                  >\n-                    {t('mapCurrentLocation')}\n-                  </Button>\n-                </div>\n-              </div>\n-\n-              {/* Revoke Token Section */}\n-              <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n-                <div className=\"flex items-center justify-between\">\n-                  <div className=\"flex items-center\">\n-                    <span className=\"bg-red-100 text-red-600 p-1.5 rounded-lg mr-2\">\n-                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                        <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n-                      </svg>\n-                    </span>\n-                    <h2 className=\"text-xl font-bold text-gray-800\">{t('userRevokeToken')}</h2>\n-                  </div>\n-                  <Button\n-                    variant=\"contained\"\n-                    color=\"error\"\n                     onClick={() => setRevokeDialogOpen(true)}\n-                    className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n                   >\n                     {t('userRevokeToken')}\n                   </Button>\n-                </div>\n-              </div>\n-\n-              {/* Attributes Section */}\n-              <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n-                <div className=\"flex items-center\">\n-                  <span className=\"bg-indigo-100 text-indigo-600 p-1.5 rounded-lg mr-2\">\n-                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                      <path d=\"M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z\" />\n-                    </svg>\n-                  </span>\n-                  <h2 className=\"text-xl font-bold text-gray-800\">{t('sharedAttributeDetails')}</h2>\n-                </div>\n-                <div className=\"mt-4\">\n-                  <EditAttributesAccordion\n-                    attribute={attribute}\n-                    attributes={item.attributes}\n-                    setAttributes={(attributes) => setItem({ ...item, attributes })}\n-                    definitions={{ ...commonUserAttributes, ...userAttributes }}\n-                    focusAttribute={attribute}\n-                    className=\"w-full\"\n-                  />\n-                </div>\n-              </div>\n-\n-              {/* Delete Account Section - Only for non-managers */}\n-              {registrationEnabled && item.id === currentUser.id && !manager && (\n-                <div className=\"bg-gradient-to-br from-red-50 to-red-100 rounded-2xl shadow-xl p-6 border border-red-200\">\n-                  <div className=\"flex items-center\">\n-                    <span className=\"bg-red-100 text-red-600 p-1.5 rounded-lg mr-2\">\n-                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                        <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n-                      </svg>\n-                    </span>\n-                    <h2 className=\"text-xl font-bold text-red-800\">{t('userDeleteAccount')}</h2>\n-                  </div>\n-                  <div className=\"mt-4 space-y-4\">\n-                    <div>\n-                      <label className=\"block text-sm font-medium text-red-700 mb-2\">{t('userEmail')}</label>\n-                      <TextField\n-                        value={deleteEmail || ''}\n-                        onChange={(e) => setDeleteEmail(e.target.value)}\n-                        error={deleteFailed}\n-                        fullWidth\n-                        InputProps={{\n-                          className: \"rounded-xl\"\n-                        }}\n-                        className=\"bg-white rounded-xl border border-red-300 focus:ring-2 focus:ring-red-500 focus:border-red-500\"\n-                      />\n-                      {deleteFailed && (\n-                        <p className=\"mt-1 text-sm text-red-600\">{t('userDeleteConfirm')}</p>\n-                      )}\n-                    </div>\n-\n-                    <div className=\"flex justify-end\">\n-                      <Button\n-                        variant=\"contained\"\n-                        color=\"error\"\n-                        onClick={handleDelete}\n-                        startIcon={<DeleteForeverIcon />}\n-                        className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-xl hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n-                      >\n-                        {t('userDeleteAccount')}\n-                      </Button>\n-                    </div>\n-                  </div>\n-                </div>\n-              )}\n-            </div>\n-          </div>\n-        </div>\n-      )}\n-      <Dialog open={revokeDialogOpen} onClose={closeRevokeDialog} fullWidth maxWidth=\"sm\">\n-        <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-6 border border-gray-200\">\n-          <div className=\"flex justify-between items-center mb-4\">\n-            <h3 className=\"text-lg font-bold text-gray-800 flex items-center\">\n-              <span className=\"bg-red-100 text-red-600 p-1.5 rounded-lg mr-2\">\n-                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n-                  <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n-                </svg>\n-              </span>\n-              {t('userRevokeToken')}\n-            </h3>\n-            <button\n-              onClick={closeRevokeDialog}\n-              className=\"text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100\"\n-            >\n-              <CloseIcon />\n-            </button>\n-          </div>\n-\n-          <div className=\"mb-6\">\n-            <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userToken')}</label>\n-            <TextField\n-              value={revokeToken}\n-              onChange={(e) => setRevokeToken(e.target.value)}\n-              autoFocus\n-              fullWidth\n-              InputProps={{\n-                className: \"rounded-xl\"\n-              }}\n-              className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n-            />\n-          </div>\n-\n-          <div className=\"flex justify-end space-x-3\">\n+                </CardContent>\n+              </Card>\n+            </Grid>\n+          </Grid>\n+          <div className={classes.buttons}>\n             <Button\n-              onClick={closeRevokeDialog}\n+              color=\"primary\"\n               variant=\"outlined\"\n-              className=\"border-gray-300 text-gray-700 hover:bg-gray-50 px-6 py-2 rounded-xl\"\n+              onClick={() => navigate(-1)}\n+              disabled={!item}\n             >\n               {t('sharedCancel')}\n             </Button>\n             <Button\n-              onClick={handleRevokeToken}\n-              disabled={!revokeToken}\n+              color=\"primary\"\n               variant=\"contained\"\n-              className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-2 rounded-xl hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n+              onClick={handleSave}\n+              disabled={!item || !validate()}\n             >\n-              {t('userRevokeToken')}\n+              {t('sharedSave')}\n             </Button>\n           </div>\n-        </div>\n-      </Dialog>\n-    </EditItemView>\n+          <Dialog open={revokeDialogOpen} onClose={closeRevokeDialog} fullWidth maxWidth=\"xs\">\n+            <DialogContent>\n+              <TextField\n+                value={revokeToken}\n+                onChange={(e) => setRevokeToken(e.target.value)}\n+                label={t('userToken')}\n+                autoFocus\n+                fullWidth\n+              />\n+            </DialogContent>\n+            <DialogActions>\n+              <Button onClick={closeRevokeDialog}>{t('sharedCancel')}</Button>\n+              <Button onClick={handleRevokeToken} disabled={!revokeToken} variant=\"contained\">\n+                {t('userRevokeToken')}\n+              </Button>\n+            </DialogActions>\n+          </Dialog>\n+        </Container>\n+      )}\n+    </PageLayout>\n   );\n };\n \n export default UserPage;\n"
                },
                {
                    "date": 1765801393270,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -441,9 +441,9 @@\n                         variant=\"outlined\"\n                         color=\"primary\"\n                         onClick={() => {\n                           const { lng, lat } = map.getCenter();\n-                          setItem({time\n+                          setItem({\n                             ...item,\n                             latitude: Number(lat.toFixed(6)),\n                             longitude: Number(lng.toFixed(6)),\n                             zoom: Number(map.getZoom().toFixed(1)),\n"
                },
                {
                    "date": 1765801807340,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -273,65 +273,67 @@\n                         disabled={!admin}\n                         fullWidth\n                       />\n                     </Grid>\n-                    <Grid item xs={12} container spacing={1}>\n-                      <Grid item xs={12} sm={6}>\n-                        <FormControlLabel\n-                          control={<Checkbox checked={item.disabled || false} onChange={(e) => setItem({ ...item, disabled: e.target.checked })} />}\n-                          label={t('sharedDisabled')}\n-                          disabled={!manager}\n-                          sx={{ display: 'block' }}\n-                        />\n+                    <Grid item xs={12}>\n+                      <Grid container spacing={1}>\n+                        <Grid item xs={12} sm={6}>\n+                          <FormControlLabel\n+                            control={<Checkbox checked={item.disabled || false} onChange={(e) => setItem({ ...item, disabled: e.target.checked })} />}\n+                            label={t('sharedDisabled')}\n+                            disabled={!manager}\n+                            sx={{ display: 'block' }}\n+                          />\n+                        </Grid>\n+                        <Grid item xs={12} sm={6}>\n+                          <FormControlLabel\n+                            control={<Checkbox checked={item.administrator || false} onChange={(e) => setItem({ ...item, administrator: e.target.checked })} />}\n+                            label={t('userAdmin')}\n+                            disabled={!admin}\n+                            sx={{ display: 'block' }}\n+                          />\n+                        </Grid>\n+                        <Grid item xs={12} sm={6}>\n+                          <FormControlLabel\n+                            control={<Checkbox checked={item.readonly || false} onChange={(e) => setItem({ ...item, readonly: e.target.checked })} />}\n+                            label={t('serverReadonly')}\n+                            disabled={!manager}\n+                            sx={{ display: 'block' }}\n+                          />\n+                        </Grid>\n+                        <Grid item xs={12} sm={6}>\n+                          <FormControlLabel\n+                            control={<Checkbox checked={item.deviceReadonly || false} onChange={(e) => setItem({ ...item, deviceReadonly: e.target.checked })} />}\n+                            label={t('userDeviceReadonly')}\n+                            disabled={!manager}\n+                            sx={{ display: 'block' }}\n+                          />\n+                        </Grid>\n+                        <Grid item xs={12} sm={6}>\n+                          <FormControlLabel\n+                            control={<Checkbox checked={item.limitCommands || false} onChange={(e) => setItem({ ...item, limitCommands: e.target.checked })} />}\n+                            label={t('userLimitCommands')}\n+                            disabled={!manager}\n+                            sx={{ display: 'block' }}\n+                          />\n+                        </Grid>\n+                        <Grid item xs={12} sm={6}>\n+                          <FormControlLabel\n+                            control={<Checkbox checked={item.disableReports || false} onChange={(e) => setItem({ ...item, disableReports: e.target.checked })} />}\n+                            label={t('userDisableReports')}\n+                            disabled={!manager}\n+                            sx={{ display: 'block' }}\n+                          />\n+                        </Grid>\n+                        <Grid item xs={12} sm={6}>\n+                          <FormControlLabel\n+                            control={<Checkbox checked={item.fixedEmail || false} onChange={(e) => setItem({ ...item, fixedEmail: e.target.checked })} />}\n+                            label={t('userFixedEmail')}\n+                            disabled={!manager}\n+                            sx={{ display: 'block' }}\n+                          />\n+                        </Grid>\n                       </Grid>\n-                      <Grid item xs={12} sm={6}>\n-                        <FormControlLabel\n-                          control={<Checkbox checked={item.administrator || false} onChange={(e) => setItem({ ...item, administrator: e.target.checked })} />}\n-                          label={t('userAdmin')}\n-                          disabled={!admin}\n-                          sx={{ display: 'block' }}\n-                        />\n-                      </Grid>\n-                      <Grid item xs={12} sm={6}>\n-                        <FormControlLabel\n-                          control={<Checkbox checked={item.readonly || false} onChange={(e) => setItem({ ...item, readonly: e.target.checked })} />}\n-                          label={t('serverReadonly')}\n-                          disabled={!manager}\n-                          sx={{ display: 'block' }}\n-                        />\n-                      </Grid>\n-                      <Grid item xs={12} sm={6}>\n-                        <FormControlLabel\n-                          control={<Checkbox checked={item.deviceReadonly || false} onChange={(e) => setItem({ ...item, deviceReadonly: e.target.checked })} />}\n-                          label={t('userDeviceReadonly')}\n-                          disabled={!manager}\n-                          sx={{ display: 'block' }}\n-                        />\n-                      </Grid>\n-                      <Grid item xs={12} sm={6}>\n-                        <FormControlLabel\n-                          control={<Checkbox checked={item.limitCommands || false} onChange={(e) => setItem({ ...item, limitCommands: e.target.checked })} />}\n-                          label={t('userLimitCommands')}\n-                          disabled={!manager}\n-                          sx={{ display: 'block' }}\n-                        />\n-                      </Grid>\n-                      <Grid item xs={12} sm={6}>\n-                        <FormControlLabel\n-                          control={<Checkbox checked={item.disableReports || false} onChange={(e) => setItem({ ...item, disableReports: e.target.checked })} />}\n-                          label={t('userDisableReports')}\n-                          disabled={!manager}\n-                          sx={{ display: 'block' }}\n-                        />\n-                      </Grid>\n-                      <Grid item xs={12} sm={6}>\n-                        <FormControlLabel\n-                          control={<Checkbox checked={item.fixedEmail || false} onChange={(e) => setItem({ ...item, fixedEmail: e.target.checked })} />}\n-                          label={t('userFixedEmail')}\n-                          disabled={!manager}\n-                          sx={{ display: 'block' }}\n-                        />\n-                      </Grid>\n                     </Grid>\n                   </Grid>\n                 </CardContent>\n               </Card>\n@@ -342,17 +344,17 @@\n               <Card>\n                 <CardContent>\n                   <Typography variant=\"h6\" gutterBottom>{t('sharedPreferences')}</Typography>\n                   <Grid container spacing={2}>\n-                    <Grid item xs={12} sm={6}>\n+                    <Grid item xs={12} md={6}>\n                       <TextField\n                         label={t('sharedPhone')}\n                         value={item.phone || ''}\n                         onChange={(e) => setItem({ ...item, phone: e.target.value })}\n-                        fullWidth\n+                        fullWidthtime\n                       />\n                     </Grid>\n-                    <Grid item xs={12} sm={6}>\n+                    <Grid item xs={12} md={6}>\n                       <FormControl fullWidth>\n                         <Select\n                           value={item.map || 'locationIqStreets'}\n                           onChange={(e) => setItem({ ...item, map: e.target.value })}\n@@ -364,9 +366,9 @@\n                           ))}\n                         </Select>\n                       </FormControl>\n                     </Grid>\n-                    <Grid item xs={12} sm={6}>\n+                    <Grid item xs={12} md={6}>\n                       <FormControl fullWidth>\n                         <Select\n                           value={item.coordinateFormat || 'dd'}\n                           onChange={(e) => setItem({ ...item, coordinateFormat: e.target.value })}\n@@ -376,18 +378,18 @@\n                           <MenuItem value=\"dms\">{t('sharedDegreesMinutesSeconds')}</MenuItem>\n                         </Select>\n                       </FormControl>\n                     </Grid>\n-                    <Grid item xs={12} sm={6}>\n+                    <Grid item xs={12} md={6}>\n                       <SelectField\n                         label={t('sharedTimezone')}\n                         value={item.attributes && item.attributes.timezone}\n                         onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, timezone: e.target.value } })}\n                         endpoint=\"/api/server/timezones\"\n                         keyGetter={(it) => it}\n                         titleGetter={(it) => it}\n                         fullWidth\n-                        sx={{ width: '100%' }}\n+                        sx={{ width: '100%', '& .MuiSelect-root': { width: '100%' } }}\n                       />\n                     </Grid>\n                     <Grid item xs={12}>\n                       <TextField\n"
                },
                {
                    "date": 1765802499967,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -349,16 +349,17 @@\n                       <TextField\n                         label={t('sharedPhone')}\n                         value={item.phone || ''}\n                         onChange={(e) => setItem({ ...item, phone: e.target.value })}\n-                        fullWidthtime\n+                        fullWidth\n                       />\n                     </Grid>\n                     <Grid item xs={12} md={6}>\n                       <FormControl fullWidth>\n                         <Select\n                           value={item.map || 'locationIqStreets'}\n                           onChange={(e) => setItem({ ...item, map: e.target.value })}\n+                          sx={{ height: '100%' }}  /* Ensure full height in paired container */\n                         >\n                           {mapStyles.filter((style) => style.available).map((style) => (\n                             <MenuItem key={style.id} value={style.id}>\n                               <Typography component=\"span\">{style.title}</Typography>\n@@ -379,19 +380,25 @@\n                         </Select>\n                       </FormControl>\n                     </Grid>\n                     <Grid item xs={12} md={6}>\n-                      <SelectField\n-                        label={t('sharedTimezone')}\n-                        value={item.attributes && item.attributes.timezone}\n-                        onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, timezone: e.target.value } })}\n-                        endpoint=\"/api/server/timezones\"\n-                        keyGetter={(it) => it}\n-                        titleGetter={(it) => it}\n-                        fullWidth\n-                        sx={{ width: '100%', '& .MuiSelect-root': { width: '100%' } }}\n-                      />\n-                    </Grid>\n+  <FormControl fullWidth>\n+    <SelectField\n+      label={t('sharedTimezone')}\n+      value={item.attributes?.timezone || ''}\n+      onChange={(e) =>\n+        setItem({\n+          ...item,\n+          attributes: { ...item.attributes, timezone: e.target.value },\n+        })\n+      }\n+      endpoint=\"/api/server/timezones\"\n+      keyGetter={(it) => it}\n+      titleGetter={(it) => it}\n+    />\n+  </FormControl>\n+</Grid>\n+\n                     <Grid item xs={12}>\n                       <TextField\n                         label={t('mapPoiLayer')}\n                         value={item.poiLayer || ''}\n"
                },
                {
                    "date": 1765802535503,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -380,25 +380,19 @@\n                         </Select>\n                       </FormControl>\n                     </Grid>\n                     <Grid item xs={12} md={6}>\n-  <FormControl fullWidth>\n-    <SelectField\n-      label={t('sharedTimezone')}\n-      value={item.attributes?.timezone || ''}\n-      onChange={(e) =>\n-        setItem({\n-          ...item,\n-          attributes: { ...item.attributes, timezone: e.target.value },\n-        })\n-      }\n-      endpoint=\"/api/server/timezones\"\n-      keyGetter={(it) => it}\n-      titleGetter={(it) => it}\n-    />\n-  </FormControl>\n-</Grid>\n-\n+                      <SelectField\n+                        label={t('sharedTimezone')}\n+                        value={item.attributes && item.attributes.timezone}\n+                        onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, timezone: e.target.value } })}\n+                        endpoint=\"/api/server/timezones\"\n+                        keyGetter={(it) => it}\n+                        titleGetter={(it) => it}\n+                        fullWidth\n+                        sx={{ width: '100%', '& .MuiInputBase-root': { width: '100%' } }}\n+                      />\n+                    </Grid>\n                     <Grid item xs={12}>\n                       <TextField\n                         label={t('mapPoiLayer')}\n                         value={item.poiLayer || ''}\n"
                }
            ],
            "date": 1765713836138,
            "name": "Commit-0",
            "content": "import { useEffect, useState } from 'react';\nimport { useNavigate, useParams, useSearchParams } from 'react-router-dom';\nimport {\n  Accordion,\n  AccordionSummary,\n  AccordionDetails,\n  Typography,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  FormControlLabel,\n  Checkbox,\n  FormGroup,\n  TextField,\n  Button,\n  InputAdornment,\n  IconButton,\n  OutlinedInput,\n  Dialog,\n  DialogContent,\n  DialogActions,\n} from '@mui/material';\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\nimport DeleteForeverIcon from '@mui/icons-material/DeleteForever';\nimport CachedIcon from '@mui/icons-material/Cached';\nimport CloseIcon from '@mui/icons-material/Close';\nimport { useDispatch, useSelector } from 'react-redux';\nimport EditItemView from './components/EditItemView';\nimport EditAttributesAccordion from './components/EditAttributesAccordion';\nimport { useTranslation } from '../common/components/LocalizationProvider';\nimport useUserAttributes from '../common/attributes/useUserAttributes';\nimport { sessionActions } from '../store';\nimport SelectField from '../common/components/SelectField';\nimport SettingsMenu from './components/SettingsMenu';\nimport useCommonUserAttributes from '../common/attributes/useCommonUserAttributes';\nimport { useAdministrator, useRestriction, useManager } from '../common/util/permissions';\nimport { useCatch } from '../reactHelper';\nimport useMapStyles from '../map/core/useMapStyles';\nimport { map } from '../map/core/MapView';\nimport fetchOrThrow from '../common/util/fetchOrThrow';\n\nconst UserPage = () => {\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const t = useTranslation();\n\n  const admin = useAdministrator();\n  const manager = useManager();\n  const fixedEmail = useRestriction('fixedEmail');\n\n  const currentUser = useSelector((state) => state.session.user);\n  const registrationEnabled = useSelector((state) => state.session.server.registration);\n  const openIdForced = useSelector((state) => state.session.server.openIdForce);\n  const totpEnable = useSelector((state) => state.session.server.attributes.totpEnable);\n  const totpForce = useSelector((state) => state.session.server.attributes.totpForce);\n\n  const mapStyles = useMapStyles();\n  const commonUserAttributes = useCommonUserAttributes(t);\n  const userAttributes = useUserAttributes(t);\n\n  const { id } = useParams();\n  const [item, setItem] = useState(id === currentUser.id.toString() ? currentUser : null);\n\n  const [deleteEmail, setDeleteEmail] = useState();\n  const [deleteFailed, setDeleteFailed] = useState(false);\n  const [revokeDialogOpen, setRevokeDialogOpen] = useState(false);\n  const [revokeToken, setRevokeToken] = useState('');\n\n  const handleDelete = useCatch(async () => {\n    if (deleteEmail === currentUser.email) {\n      setDeleteFailed(false);\n      await fetchOrThrow(`/api/users/${currentUser.id}`, { method: 'DELETE' });\n      navigate('/login');\n      dispatch(sessionActions.updateUser(null));\n    } else {\n      setDeleteFailed(true);\n    }\n  });\n\n  const handleGenerateTotp = useCatch(async () => {\n    const response = await fetchOrThrow('/api/users/totp', { method: 'POST' });\n    setItem({ ...item, totpKey: await response.text() });\n  });\n\n  const closeRevokeDialog = () => {\n    setRevokeDialogOpen(false);\n    setRevokeToken('');\n  };\n\n  const handleRevokeToken = useCatch(async () => {\n    await fetchOrThrow('/api/session/token/revoke', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n      body: new URLSearchParams({ token: revokeToken }).toString(),\n    });\n    closeRevokeDialog();\n  });\n\n  // Handle user type change with appropriate defaults\n  const handleUserTypeChange = (role) => {\n    if (role === 'manager') {\n      setItem({\n        ...item,\n        administrator: false,\n        userLimit: 1,\n        deviceLimit: 0,\n        deviceReadonly: false\n      });\n    } else if (role === 'user') {\n      setItem({\n        ...item,\n        administrator: false,\n        userLimit: 0,\n        deviceLimit: 0,\n        deviceReadonly: true\n      });\n    }\n  };\n\n  const [searchParams, setSearchParams] = useSearchParams();\n  const attribute = searchParams.get('attribute');\n\n  useEffect(() => {\n    if (item && attribute && !item.attributes.hasOwnProperty('attribute')) {\n      const updatedAttributes = { ...item.attributes };\n      updatedAttributes[attribute] = '';\n      setItem({ ...item, attributes: updatedAttributes });\n\n      const newParams = new URLSearchParams(searchParams);\n      newParams.delete('attribute');\n      setSearchParams(newParams, { replace: true });\n    }\n  }, [item, searchParams, setSearchParams, attribute]);\n\n  const onItemSaved = (result) => {\n    if (result.id === currentUser.id) {\n      dispatch(sessionActions.updateUser(result));\n    }\n  };\n\n  const validate = () => item && item.name && item.email && (item.id || item.password) && (admin || !totpForce || item.totpKey);\n\n  return (\n    <EditItemView\n      endpoint=\"users\"\n      item={item}\n      setItem={setItem}\n      defaultItem={admin ? { deviceLimit: 0, userLimit: 0, administrator: false, deviceReadonly: true } : {}}\n      validate={validate}\n      onItemSaved={onItemSaved}\n      menu={<SettingsMenu />}\n      breadcrumbs={['settingsTitle', 'settingsUser']}\n    >\n      {item && (\n        <div className=\"p-6 max-w-7xl mx-auto\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            {/* Left Column - Basic Information */}\n            <div className=\"lg:col-span-1 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n              <h2 className=\"text-xl font-bold text-gray-800 mb-6 pb-3 border-b border-gray-200 flex items-center\">\n                <span className=\"bg-blue-100 text-blue-600 p-1.5 rounded-lg mr-2\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                    <path fillRule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clipRule=\"evenodd\" />\n                  </svg>\n                </span>\n                {t('sharedRequired')}\n              </h2>\n\n              <div className=\"space-y-6\">\n                {admin && (\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userType')}</label>\n                    <div className=\"relative\">\n                      <FormControl fullWidth>\n                        <Select\n                          value={\n                            (item.userLimit === 1 && item.deviceLimit === 0) ? 'manager' : 'user'\n                          }\n                          onChange={(e) => handleUserTypeChange(e.target.value)}\n                          className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        >\n                          <MenuItem value=\"manager\">{t('userTypeManager')}</MenuItem>\n                          <MenuItem value=\"user\">{t('userTypeUser')}</MenuItem>\n                        </Select>\n                      </FormControl>\n                    </div>\n                  </div>\n                )}\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('sharedName')}</label>\n                  <div className=\"relative\">\n                    <TextField\n                      value={item.name || ''}\n                      onChange={(e) => setItem({ ...item, name: e.target.value })}\n                      fullWidth\n                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                      InputProps={{\n                        className: \"rounded-xl\"\n                      }}\n                    />\n                    <div className=\"absolute inset-y-0 right-0 flex items-center pr-3\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path fillRule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clipRule=\"evenodd\" />\n                      </svg>\n                    </div>\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userEmail')}</label>\n                  <div className=\"relative\">\n                    <TextField\n                      value={item.email || ''}\n                      onChange={(e) => setItem({ ...item, email: e.target.value })}\n                      fullWidth\n                      disabled={fixedEmail && item.id === currentUser.id}\n                      className={`bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${fixedEmail && item.id === currentUser.id ? 'bg-gray-100' : ''}`}\n                      InputProps={{\n                        className: \"rounded-xl\"\n                      }}\n                    />\n                    <div className=\"absolute inset-y-0 right-0 flex items-center pr-3\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path d=\"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z\" />\n                        <path d=\"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z\" />\n                      </svg>\n                    </div>\n                  </div>\n                </div>\n\n                {!openIdForced && (\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userPassword')}</label>\n                    <div className=\"relative\">\n                      <TextField\n                        type=\"password\"\n                        value={item.password || ''}\n                        onChange={(e) => setItem({ ...item, password: e.target.value })}\n                        fullWidth\n                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        InputProps={{\n                          className: \"rounded-xl\"\n                        }}\n                      />\n                      <div className=\"absolute inset-y-0 right-0 flex items-center pr-3\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                          <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\n                        </svg>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {totpEnable && (\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('loginTotpKey')}</label>\n                    <div className=\"relative\">\n                      <FormControl fullWidth>\n                        <OutlinedInput\n                          readOnly\n                          value={item.totpKey || ''}\n                          className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                          endAdornment={(\n                            <InputAdornment position=\"end\">\n                              <div className=\"flex space-x-2\">\n                                <IconButton size=\"small\" edge=\"end\" onClick={handleGenerateTotp}>\n                                  <CachedIcon fontSize=\"small\" className=\"text-blue-600\" />\n                                </IconButton>\n                                <IconButton size=\"small\" edge=\"end\" onClick={() => setItem({ ...item, totpKey: null })}>\n                                  <CloseIcon fontSize=\"small\" className=\"text-red-600\" />\n                                </IconButton>\n                              </div>\n                            </InputAdornment>\n                          )}\n                        />\n                      </FormControl>\n                      <div className=\"absolute inset-y-0 right-32 flex items-center pr-3\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-gray-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                          <path fillRule=\"evenodd\" d=\"M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 2 2 0 012 2 1 1 0 102 0 4 4 0 00-4-4z\" clipRule=\"evenodd\" />\n                        </svg>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Right Column - Permissions, Preferences, Location */}\n            <div className=\"lg:col-span-2 space-y-6\">\n              {/* Permissions Section */}\n              <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n                <h2 className=\"text-xl font-bold text-gray-800 mb-6 pb-3 border-b border-gray-200 flex items-center\">\n                  <span className=\"bg-green-100 text-green-600 p-1.5 rounded-lg mr-2\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\n                    </svg>\n                  </span>\n                  {t('sharedPermissions')}\n                </h2>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userExpirationTime')}</label>\n                    <TextField\n                      type=\"date\"\n                      value={item.expirationTime ? item.expirationTime.split('T')[0] : '2099-01-01'}\n                      onChange={(e) => {\n                        if (e.target.value) {\n                          setItem({ ...item, expirationTime: new Date(e.target.value).toISOString() });\n                        }\n                      }}\n                      disabled={!manager}\n                      fullWidth\n                      InputProps={{\n                        className: \"rounded-xl\"\n                      }}\n                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userDeviceLimit')}</label>\n                    <TextField\n                      type=\"number\"\n                      value={item.deviceLimit || 0}\n                      onChange={(e) => setItem({ ...item, deviceLimit: Number(e.target.value) })}\n                      disabled={!admin}\n                      fullWidth\n                      InputProps={{\n                        className: \"rounded-xl\"\n                      }}\n                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userUserLimit')}</label>\n                    <TextField\n                      type=\"number\"\n                      value={item.userLimit || 0}\n                      onChange={(e) => setItem({ ...item, userLimit: Number(e.target.value) })}\n                      disabled={!admin}\n                      fullWidth\n                      InputProps={{\n                        className: \"rounded-xl\"\n                      }}\n                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n                    <FormControlLabel\n                      control={\n                        <Checkbox\n                          checked={item.disabled}\n                          onChange={(e) => setItem({ ...item, disabled: e.target.checked })}\n                          className=\"text-blue-600\"\n                        />\n                      }\n                      label={t('sharedDisabled')}\n                      disabled={!manager}\n                      className=\"m-0\"\n                    />\n                  </div>\n\n                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n                    <FormControlLabel\n                      control={\n                        <Checkbox\n                          checked={item.administrator}\n                          onChange={(e) => setItem({ ...item, administrator: e.target.checked })}\n                          className=\"text-blue-600\"\n                        />\n                      }\n                      label={t('userAdmin')}\n                      disabled={!admin}\n                      className=\"m-0\"\n                    />\n                  </div>\n\n                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n                    <FormControlLabel\n                      control={\n                        <Checkbox\n                          checked={item.readonly}\n                          onChange={(e) => setItem({ ...item, readonly: e.target.checked })}\n                          className=\"text-blue-600\"\n                        />\n                      }\n                      label={t('serverReadonly')}\n                      disabled={!manager}\n                      className=\"m-0\"\n                    />\n                  </div>\n\n                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n                    <FormControlLabel\n                      control={\n                        <Checkbox\n                          checked={item.deviceReadonly}\n                          onChange={(e) => setItem({ ...item, deviceReadonly: e.target.checked })}\n                          className=\"text-blue-600\"\n                        />\n                      }\n                      label={t('userDeviceReadonly')}\n                      disabled={!manager}\n                      className=\"m-0\"\n                    />\n                  </div>\n\n                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n                    <FormControlLabel\n                      control={\n                        <Checkbox\n                          checked={item.limitCommands}\n                          onChange={(e) => setItem({ ...item, limitCommands: e.target.checked })}\n                          className=\"text-blue-600\"\n                        />\n                      }\n                      label={t('userLimitCommands')}\n                      disabled={!manager}\n                      className=\"m-0\"\n                    />\n                  </div>\n\n                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n                    <FormControlLabel\n                      control={\n                        <Checkbox\n                          checked={item.disableReports}\n                          onChange={(e) => setItem({ ...item, disableReports: e.target.checked })}\n                          className=\"text-blue-600\"\n                        />\n                      }\n                      label={t('userDisableReports')}\n                      disabled={!manager}\n                      className=\"m-0\"\n                    />\n                  </div>\n\n                  <div className=\"flex items-center p-3 bg-gray-50 rounded-lg\">\n                    <FormControlLabel\n                      control={\n                        <Checkbox\n                          checked={item.fixedEmail}\n                          onChange={(e) => setItem({ ...item, fixedEmail: e.target.checked })}\n                          className=\"text-blue-600\"\n                        />\n                      }\n                      label={t('userFixedEmail')}\n                      disabled={!manager}\n                      className=\"m-0\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Preferences Section */}\n              <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n                <h2 className=\"text-xl font-bold text-gray-800 mb-6 pb-3 border-b border-gray-200 flex items-center\">\n                  <span className=\"bg-purple-100 text-purple-600 p-1.5 rounded-lg mr-2\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path d=\"M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z\" />\n                    </svg>\n                  </span>\n                  {t('sharedPreferences')}\n                </h2>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('sharedPhone')}</label>\n                    <TextField\n                      value={item.phone || ''}\n                      onChange={(e) => setItem({ ...item, phone: e.target.value })}\n                      fullWidth\n                      InputProps={{\n                        className: \"rounded-xl\"\n                      }}\n                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('mapDefault')}</label>\n                    <FormControl fullWidth>\n                      <Select\n                        value={item.map || 'locationIqStreets'}\n                        onChange={(e) => setItem({ ...item, map: e.target.value })}\n                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        MenuProps={{\n                          classes: { paper: \"rounded-xl\" }\n                        }}\n                      >\n                        {mapStyles.filter((style) => style.available).map((style) => (\n                          <MenuItem key={style.id} value={style.id}>\n                            <Typography component=\"span\">{style.title}</Typography>\n                          </MenuItem>\n                        ))}\n                      </Select>\n                    </FormControl>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('settingsCoordinateFormat')}</label>\n                    <FormControl fullWidth>\n                      <Select\n                        value={item.coordinateFormat || 'dd'}\n                        onChange={(e) => setItem({ ...item, coordinateFormat: e.target.value })}\n                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        MenuProps={{\n                          classes: { paper: \"rounded-xl\" }\n                        }}\n                      >\n                        <MenuItem value=\"dd\">{t('sharedDecimalDegrees')}</MenuItem>\n                        <MenuItem value=\"ddm\">{t('sharedDegreesDecimalMinutes')}</MenuItem>\n                        <MenuItem value=\"dms\">{t('sharedDegreesMinutesSeconds')}</MenuItem>\n                      </Select>\n                    </FormControl>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('settingsSpeedUnit')}</label>\n                    <FormControl fullWidth>\n                      <Select\n                        value={(item.attributes && item.attributes.speedUnit) || 'kn'}\n                        onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, speedUnit: e.target.value } })}\n                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        MenuProps={{\n                          classes: { paper: \"rounded-xl\" }\n                        }}\n                      >\n                        <MenuItem value=\"kn\">{t('sharedKn')}</MenuItem>\n                        <MenuItem value=\"kmh\">{t('sharedKmh')}</MenuItem>\n                        <MenuItem value=\"mph\">{t('sharedMph')}</MenuItem>\n                      </Select>\n                    </FormControl>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('settingsDistanceUnit')}</label>\n                    <FormControl fullWidth>\n                      <Select\n                        value={(item.attributes && item.attributes.distanceUnit) || 'km'}\n                        onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, distanceUnit: e.target.value } })}\n                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        MenuProps={{\n                          classes: { paper: \"rounded-xl\" }\n                        }}\n                      >\n                        <MenuItem value=\"km\">{t('sharedKm')}</MenuItem>\n                        <MenuItem value=\"mi\">{t('sharedMi')}</MenuItem>\n                        <MenuItem value=\"nmi\">{t('sharedNmi')}</MenuItem>\n                      </Select>\n                    </FormControl>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('settingsAltitudeUnit')}</label>\n                    <FormControl fullWidth>\n                      <Select\n                        value={(item.attributes && item.attributes.altitudeUnit) || 'm'}\n                        onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, altitudeUnit: e.target.value } })}\n                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        MenuProps={{\n                          classes: { paper: \"rounded-xl\" }\n                        }}\n                      >\n                        <MenuItem value=\"m\">{t('sharedMeters')}</MenuItem>\n                        <MenuItem value=\"ft\">{t('sharedFeet')}</MenuItem>\n                      </Select>\n                    </FormControl>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('settingsVolumeUnit')}</label>\n                    <FormControl fullWidth>\n                      <Select\n                        value={(item.attributes && item.attributes.volumeUnit) || 'ltr'}\n                        onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, volumeUnit: e.target.value } })}\n                        className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        MenuProps={{\n                          classes: { paper: \"rounded-xl\" }\n                        }}\n                      >\n                        <MenuItem value=\"ltr\">{t('sharedLiter')}</MenuItem>\n                        <MenuItem value=\"usGal\">{t('sharedUsGallon')}</MenuItem>\n                        <MenuItem value=\"impGal\">{t('sharedImpGallon')}</MenuItem>\n                      </Select>\n                    </FormControl>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('sharedTimezone')}</label>\n                    <SelectField\n                      value={item.attributes && item.attributes.timezone}\n                      onChange={(e) => setItem({ ...item, attributes: { ...item.attributes, timezone: e.target.value } })}\n                      endpoint=\"/api/server/timezones\"\n                      keyGetter={(it) => it}\n                      titleGetter={(it) => it}\n                      label={t('sharedTimezone')}\n                      fullWidth\n                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('mapPoiLayer')}</label>\n                    <TextField\n                      value={item.poiLayer || ''}\n                      onChange={(e) => setItem({ ...item, poiLayer: e.target.value })}\n                      fullWidth\n                      InputProps={{\n                        className: \"rounded-xl\"\n                      }}\n                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Location Section */}\n              <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n                <h2 className=\"text-xl font-bold text-gray-800 mb-6 pb-3 border-b border-gray-200 flex items-center\">\n                  <span className=\"bg-yellow-100 text-yellow-600 p-1.5 rounded-lg mr-2\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path fillRule=\"evenodd\" d=\"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z\" clipRule=\"evenodd\" />\n                    </svg>\n                  </span>\n                  {t('sharedLocation')}\n                </h2>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('positionLatitude')}</label>\n                    <TextField\n                      type=\"number\"\n                      step=\"any\"\n                      value={item.latitude || 0}\n                      onChange={(e) => setItem({ ...item, latitude: Number(e.target.value) })}\n                      fullWidth\n                      InputProps={{\n                        className: \"rounded-xl\"\n                      }}\n                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('positionLongitude')}</label>\n                    <TextField\n                      type=\"number\"\n                      step=\"any\"\n                      value={item.longitude || 0}\n                      onChange={(e) => setItem({ ...item, longitude: Number(e.target.value) })}\n                      fullWidth\n                      InputProps={{\n                        className: \"rounded-xl\"\n                      }}\n                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('serverZoom')}</label>\n                    <TextField\n                      type=\"number\"\n                      step=\"any\"\n                      value={item.zoom || 0}\n                      onChange={(e) => setItem({ ...item, zoom: Number(e.target.value) })}\n                      fullWidth\n                      InputProps={{\n                        className: \"rounded-xl\"\n                      }}\n                      className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"mt-6 flex justify-end\">\n                  <Button\n                    variant=\"contained\"\n                    color=\"primary\"\n                    onClick={() => {\n                      const { lng, lat } = map.getCenter();\n                      setItem({\n                        ...item,\n                        latitude: Number(lat.toFixed(6)),\n                        longitude: Number(lng.toFixed(6)),\n                        zoom: Number(map.getZoom().toFixed(1)),\n                      });\n                    }}\n                    className=\"bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-3 rounded-xl hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n                    startIcon={\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path fillRule=\"evenodd\" d=\"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z\" clipRule=\"evenodd\" />\n                      </svg>\n                    }\n                  >\n                    {t('mapCurrentLocation')}\n                  </Button>\n                </div>\n              </div>\n\n              {/* Revoke Token Section */}\n              <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <span className=\"bg-red-100 text-red-600 p-1.5 rounded-lg mr-2\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                      </svg>\n                    </span>\n                    <h2 className=\"text-xl font-bold text-gray-800\">{t('userRevokeToken')}</h2>\n                  </div>\n                  <Button\n                    variant=\"contained\"\n                    color=\"error\"\n                    onClick={() => setRevokeDialogOpen(true)}\n                    className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n                  >\n                    {t('userRevokeToken')}\n                  </Button>\n                </div>\n              </div>\n\n              {/* Attributes Section */}\n              <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl p-6 border border-gray-100\">\n                <div className=\"flex items-center\">\n                  <span className=\"bg-indigo-100 text-indigo-600 p-1.5 rounded-lg mr-2\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path d=\"M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z\" />\n                    </svg>\n                  </span>\n                  <h2 className=\"text-xl font-bold text-gray-800\">{t('sharedAttributeDetails')}</h2>\n                </div>\n                <div className=\"mt-4\">\n                  <EditAttributesAccordion\n                    attribute={attribute}\n                    attributes={item.attributes}\n                    setAttributes={(attributes) => setItem({ ...item, attributes })}\n                    definitions={{ ...commonUserAttributes, ...userAttributes }}\n                    focusAttribute={attribute}\n                    className=\"w-full\"\n                  />\n                </div>\n              </div>\n\n              {/* Delete Account Section - Only for non-managers */}\n              {registrationEnabled && item.id === currentUser.id && !manager && (\n                <div className=\"bg-gradient-to-br from-red-50 to-red-100 rounded-2xl shadow-xl p-6 border border-red-200\">\n                  <div className=\"flex items-center\">\n                    <span className=\"bg-red-100 text-red-600 p-1.5 rounded-lg mr-2\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                        <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                      </svg>\n                    </span>\n                    <h2 className=\"text-xl font-bold text-red-800\">{t('userDeleteAccount')}</h2>\n                  </div>\n                  <div className=\"mt-4 space-y-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-red-700 mb-2\">{t('userEmail')}</label>\n                      <TextField\n                        value={deleteEmail || ''}\n                        onChange={(e) => setDeleteEmail(e.target.value)}\n                        error={deleteFailed}\n                        fullWidth\n                        InputProps={{\n                          className: \"rounded-xl\"\n                        }}\n                        className=\"bg-white rounded-xl border border-red-300 focus:ring-2 focus:ring-red-500 focus:border-red-500\"\n                      />\n                      {deleteFailed && (\n                        <p className=\"mt-1 text-sm text-red-600\">{t('userDeleteConfirm')}</p>\n                      )}\n                    </div>\n\n                    <div className=\"flex justify-end\">\n                      <Button\n                        variant=\"contained\"\n                        color=\"error\"\n                        onClick={handleDelete}\n                        startIcon={<DeleteForeverIcon fontSize=\"small\" />}\n                        className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n                      >\n                        {t('userDeleteAccount')}\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n      <Dialog open={revokeDialogOpen} onClose={closeRevokeDialog} fullWidth maxWidth=\"sm\">\n        <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl p-6 border border-gray-200\">\n          <div className=\"flex justify-between items-center mb-4\">\n            <h3 className=\"text-lg font-bold text-gray-800 flex items-center\">\n              <span className=\"bg-red-100 text-red-600 p-1.5 rounded-lg mr-2\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                  <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                </svg>\n              </span>\n              {t('userRevokeToken')}\n            </h3>\n            <button\n              onClick={closeRevokeDialog}\n              className=\"text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100\"\n            >\n              <CloseIcon />\n            </button>\n          </div>\n\n          <div className=\"mb-6\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('userToken')}</label>\n            <TextField\n              value={revokeToken}\n              onChange={(e) => setRevokeToken(e.target.value)}\n              autoFocus\n              fullWidth\n              InputProps={{\n                className: \"rounded-xl\"\n              }}\n              className=\"bg-white rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n            />\n          </div>\n\n          <div className=\"flex justify-end space-x-3\">\n            <Button\n              onClick={closeRevokeDialog}\n              variant=\"outlined\"\n              className=\"border-gray-300 text-gray-700 hover:bg-gray-50 px-4 py-2 rounded-lg\"\n            >\n              {t('sharedCancel')}\n            </Button>\n            <Button\n              onClick={handleRevokeToken}\n              disabled={!revokeToken}\n              variant=\"contained\"\n              className=\"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl\"\n            >\n              {t('userRevokeToken')}\n            </Button>\n          </div>\n        </div>\n      </Dialog>\n    </EditItemView>\n  );\n};\n\nexport default UserPage;\n"
        }
    ]
}